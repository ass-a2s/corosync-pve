From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fabian=20Gr=C3=BCnbichler?= <f.gruenbichler@proxmox.com>
Date: Wed, 22 May 2019 12:25:28 +0200
Subject: [PATCH] Revert "init: Enable StopWhenUnneeded"
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

cherry-picked from upstream master

Signed-off-by: Fabian Gr√ºnbichler <f.gruenbichler@proxmox.com>
---
 .../Revert-init-Enable-StopWhenUnneeded.patch | 31 +++++++++++++++++++
 debian/patches/series                         |  1 +
 2 files changed, 32 insertions(+)
 create mode 100644 debian/patches/Revert-init-Enable-StopWhenUnneeded.patch

diff --git a/debian/patches/Revert-init-Enable-StopWhenUnneeded.patch b/debian/patches/Revert-init-Enable-StopWhenUnneeded.patch
new file mode 100644
index 00000000..8b7f240c
--- /dev/null
+++ b/debian/patches/Revert-init-Enable-StopWhenUnneeded.patch
@@ -0,0 +1,31 @@
+From: Jan Friesse <jfriesse@redhat.com>
+Date: Thu, 4 Apr 2019 11:40:19 +0200
+Subject: Revert "init: Enable StopWhenUnneeded"
+
+This reverts commit 03d9321bc80887d4578744c26c05d61e2d9d4278.
+
+Reverted because when corosync service is not enabled and corosync
+is executed by "systemctl start corosync" it is then immediately
+shutdown because of "Unit not needed anymore. Stopping.".
+
+This is really not expected behavior.
+
+Signed-off-by: Jan Friesse <jfriesse@redhat.com>
+Reviewed-by: Christine Caulfield <ccaulfie@redhat.com>
+(cherry picked from commit 527e30a8d050c077d8adff2a5aa77d9b683a8f28)
+---
+ init/corosync.service.in | 1 -
+ 1 file changed, 1 deletion(-)
+
+diff --git a/init/corosync.service.in b/init/corosync.service.in
+index 28046ca..adf7080 100644
+--- a/init/corosync.service.in
++++ b/init/corosync.service.in
+@@ -5,7 +5,6 @@ ConditionKernelCommandLine=!nocluster
+ ConditionPathExists=/etc/corosync/corosync.conf
+ Requires=network-online.target
+ After=network-online.target
+-StopWhenUnneeded=yes
+ 
+ [Service]
+ EnvironmentFile=-@INITCONFIGDIR@/corosync
diff --git a/debian/patches/series b/debian/patches/series
index 32007175..2caabe1c 100644
--- a/debian/patches/series
+++ b/debian/patches/series
@@ -7,3 +7,4 @@ Use-the-SED-variable-provided-by-configure.patch
 Use-the-AWK-variable-provided-by-configure.patch
 pve__only-start-corosync.service-if-conf-exists.patch
 cfgtool-Improve-link-status-display.patch
+Revert-init-Enable-StopWhenUnneeded.patch
