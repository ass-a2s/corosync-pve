From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fabian=20Gr=C3=BCnbichler?= <f.gruenbichler@proxmox.com>
Date: Wed, 24 Oct 2018 15:15:33 +0200
Subject: [PATCH] only start corosync.service if conf exists
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Fabian Grünbichler <f.gruenbichler@proxmox.com>
---
 ...tart-corosync.service-if-conf-exists.patch | 24 +++++++++++++++++++
 debian/patches/series                         |  1 +
 2 files changed, 25 insertions(+)
 create mode 100644 debian/patches/pve__only-start-corosync.service-if-conf-exists.patch

diff --git a/debian/patches/pve__only-start-corosync.service-if-conf-exists.patch b/debian/patches/pve__only-start-corosync.service-if-conf-exists.patch
new file mode 100644
index 00000000..d3bd7ac5
--- /dev/null
+++ b/debian/patches/pve__only-start-corosync.service-if-conf-exists.patch
@@ -0,0 +1,24 @@
+From: =?utf-8?q?Fabian_Gr=C3=BCnbichler?= <f.gruenbichler@proxmox.com>
+Date: Mon, 13 Mar 2017 13:27:49 +0100
+Subject: only start corosync.service if conf exists
+MIME-Version: 1.0
+Content-Type: text/plain; charset="utf-8"
+Content-Transfer-Encoding: 8bit
+
+Signed-off-by: Fabian Grünbichler <f.gruenbichler@proxmox.com>
+---
+ init/corosync.service.in | 1 +
+ 1 file changed, 1 insertion(+)
+
+diff --git a/init/corosync.service.in b/init/corosync.service.in
+index 0c74306..adf7080 100644
+--- a/init/corosync.service.in
++++ b/init/corosync.service.in
+@@ -2,6 +2,7 @@
+ Description=Corosync Cluster Engine
+ Documentation=man:corosync man:corosync.conf man:corosync_overview
+ ConditionKernelCommandLine=!nocluster
++ConditionPathExists=/etc/corosync/corosync.conf
+ Requires=network-online.target
+ After=network-online.target
+ 
diff --git a/debian/patches/series b/debian/patches/series
index ea6e04ea..803038e4 100644
--- a/debian/patches/series
+++ b/debian/patches/series
@@ -51,3 +51,4 @@ vqsim-Check-result-of-icmap_set_uint32.patch
 vqsim-Check-length-of-copied-optarg.patch
 Fix-various-typos-in-ChangeLog.patch
 Enable-PrivateTmp-in-the-systemd-service-files.patch
+pve__only-start-corosync.service-if-conf-exists.patch
